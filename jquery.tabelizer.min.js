/*
 * Tabelizer 1.0.2 - multi level grouping indicators for tables
 * Version 1.0.2
 * @requires jQuery v1.6+ and jQuery.ui core
 * 
 * Copyright (c) 2014 Rafael Huisman
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
/*
 * @description Create a table with multi level grouping indicators.
 * @example $('#table1').tabelize();
 * @demo http://powerconsulting.co/Samples/Tabelizer
 * @desc Create a simple tabelized interface.
 */
!function(e){var a={};a.rowClicker=function(l){var r=e(l.currentTarget),d=r.attr("id");r.hasClass("contracted")?(r.removeClass("contracted").addClass("expanded"),a.toggleChildren(d,!0)):(r.removeClass("expanded").addClass("contracted"),a.toggleChildren(d,!1)),a.updateLines()},a.updateLines=function(){var l="",r="";if($prevRow=null,a.caller.find("tr:not(.hidden):not(.hiding)").each(function(){if($row=e(this),!$row.hasClass("header")){l=$row.data("level");for(var d=a.maxLevel;d>0;d--)$row.removeClass("l"+d+"-first").removeClass("l"+d+"-last");var n="";if(l!=r)if(""!=r&&r>l)for(var d=r;d>=l;d--)$prevRow.addClass(" l"+parseInt(d)+"-last");else""!=r&&l>r&&$prevRow.addClass(" l"+r+"-first");$row.addClass(n),r=l,$prevRow=$row}}),null!=$prevRow&&""!=r&&r>1)for(var d=r-1;d>0;d--)$prevRow.addClass(" l"+parseInt(d)+"-last")},a.toggleChildren=function(l,r){var d=!1,n=!1,i=null,s=0;a.caller.find("tr").each(function(){var a=e(this),t=a.attr("id"),o=a.data("level"),v=!1;d||t!=l?d&&!n&&null!=i&&o==s?n=!0:r&&d&&!n&&null!=i&&o!=s+1?v=!0:!r&&d&&!n&&null!=i&&s>o&&(n=!0,v=!0):(d=!0,s=o),v||!d||n||t==l||(r?(a.removeClass("hidden"),a.find("td").wrapInner('<div style="display: none;" />').parent().find("td > div").slideDown(100,function(){var a=e(this);a.replaceWith(a.contents())})):(a.addClass("hiding"),a.find("td").wrapInner('<div style="" />').parent().find("td > div").slideUp(100,function(){var l=e(this);l.replaceWith(l.contents()),a.addClass("hidden"),a.removeClass("hiding")}),a.removeClass("expanded"),a.addClass("contracted"))),i=o})},a.maxLevel=0,a.init=function(){var l="",r="";$prevRow=null,a.caller.find("tr").each(function(){if($row=e(this),!$row.hasClass("header")){l=$row.data("level");var d="l"+l+" contracted "+(l>1?" hidden":"");l>a.maxLevel&&(a.maxLevel=parseInt(l)),$row.addClass(d),$firstCol=e($row.children("td")[0]);for(var n='<div class="label">'+$firstCol.html()+"</div>",i='<div class="control"> ',s=0;l-1>=s;s++)i+=' <div class="line level'+(s+1)+'"><div class="vert"></div><div class="horz"></div></div> ';i+="</div>",$firstCol.html(i+' <div class="expander"></div> '+n),$row.on("click",a.rowClicker),r=l,$prevRow=$row}}),a.updateLines()},e.fn.tabelize=function(){a.caller=this,a.init()}}(jQuery);
